---
title: 'Azure Active Directory B2C: Troubleshooting Custom Policies | Microsoft Docs'
description: A guide to several approaches to solve errors in custom policies
services: active-directory-b2c
documentationcenter: ''
author: rojasja
manager: krassk
editor: rojasja

ms.assetid: 
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/07/2017
ms.author: joroja

---
# Azure Active Directory B2C Custom Policies and Identity Experience Framework Troubleshooting
## The basics

Identity developers using Azure AD B2C Custom Policies are challenged to configure the Identity Experience Framework in its policy language in the XML format.  This guide is both list of recommended tools and tips to discover and resolve issues quickly.  Learning to write Custom Policies is similar to learning a new language.  
*This article is focused on troubleshooting your Azure AD B2C Cusutom Policy configuration and not the relying party application or its identity library.*



## XML Editing, inproperly formatted XML is the most common error.

A good XML editor which displays XML natively, color codes content, pre-fills common terms, keeps XML elements indexed, and can validate with schema is nearly essential.  Here are two of our favorites.

* [VS Code](https://code.visualstudio.com/)
* [Notepad++](https://notepad-plus-plus.org/)

Get the XML schema definition `TrustFrameworkPolicy_0.3.0.0.xsd` from the root folder of the starter pack. XML schema validation identifies errors before uploading.  Look in the documentation of your XML editor for `XML tools` and `XML Validation`

A quick review of the rules of XML may be very valuable since Azure AD B2C will reject any formatting errors it detects.  Ocassionally, uncorrectly formatted XML may result in error messages that are misleading.

## Uploading policies and policy validation

 **Upload** validation is automatic and most errors will result in aborting an upload.  **Keep in mind that the validation includes the policy file you are trying to upload and includes the chain of files it refers to.  `RP policy file > Extensions file > Base File`  Common validation errors include:

Error snippet: `... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`
* The claimType may be misspelled, or does not exist in the Schema.
* ClaimTypes must be defined in at least one of the files in the policy.  For example ` <ClaimType Id="socialIdpUserId">`
* If the ClaimType is defined in the extensions file, but used in a TechnichalProfile in the base file, uploading the base file will result in an error.

Error snippet: `...males a reference to a ClaimsTransformation with id...`
* Same as above.

Error snippet: `Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`
* Check that the TenantId in the **<TrustFrameworkPolicy>** and the **<BasePolicy>** elements match your target B2C tenant.  



## Runtime troubleshooting

* Use `Run Now` and `https://jwtms.azurewebsites.net` to test your policies and review the contents of your token indepently of your web or mobile application. This website acts like a relying party application and displays the contents of the JWT token generated by your Azure AD B2C policy.  To create a test application in Identity Experience Framework.
    * Name: TestApp
    * Web App / web API: No
    * Native client: No
    * URL: https://jwtms.azurewebsites.net

* Use [fiddler](http://www.telerik.com/fiddler) to trace the exchange of messages between your client browser and Azure AD B2C.  You will gain an indication of where in your orchestration steps is your userjourney failing.

* Use **Application Insights** under **Development mode** to trace the behavior of your Identity Experience Framework (IEF) user journey.  In **Development mode** it is possible to observe the exchange of claims between the IEF and the various Claims Providers defined by TechnicalProfiles, such as identity providers, API-bases services, the Azure AD B2C user directory (AAD Directory), and other services like Multi-Factor-Authentication.  

## Recommended practies

**Keep multiple versions of your scenarios and group them in a project with your application.** The base, extensions, and relying party (RP) files are directly dependent on each other, save them as a group and keep separate working versions as new features are realized in your policies.  Stage them in your own file system with the application code with which they interact.  Your applications may invoke may different RP policies in a tenant and become dependent on the claims they expect from your Azure AD B2C policies.

**Develop and test Technical Profiles with known user journeys.**  Use tested Starter Pack policies to configure your Technical Profiles and test them separately before incorporating into your own user journeys

**Develop and test user journeys with tested Technical Profiles** Change the orchestration steps of a user journey step by step, progressively building your desired scenarios






