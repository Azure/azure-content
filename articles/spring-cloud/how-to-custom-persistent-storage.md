---
title: Bring Your Own Storage (BYOS) to Azure Spring Cloud as extra persistent storages for applications | Microsoft Docs
description: How to bring your own storage as persistent storages in Azure Spring Cloud
author: Xuyang Cao
ms.service: spring-cloud
ms.topic: conceptual
ms.date: 10/27/2021
ms.author: xuycao
ms.custom: devx-track-java, devx-track-azurecli
---

# Bring Your Own Storage (BYOS) to Azure Spring Cloud as extra persistent storages for applications

**This article applies to:** ✔️ Java ✔️ C#

When you use the built-in persistent storage in Azure Spring Cloud, artifacts generated by your application are uploaded into Azure Storage Accounts. Microsoft controls the encryption-at-rest and lifetime management policies for those artifacts. 

With Bring Your Own Storage, these artifacts are uploaded into a storage account that you control. That means you control the encryption-at-rest policy, the lifetime management policy and network access. You will, however, be responsible for the costs associated with that storage account.

## Prerequisites

* An existing Azure Storage Account with pre-created Azure File Share
* The Azure Spring Cloud extension for the Azure CLI

## Use the Azure CLI to enable BYOS as extra persistent storages

1. Bind your Azure Storage Account as a storage resource in Azure Spring Cloud instance

   ```azurecli
   az spring-cloud storage add --storage-type StorageAccount --account-name <Your-Account-Name> --account-key <Your-Account-Key>  -g <Resource-Group-Name> -s <Spring-Instance-Name> -n <Storage-Resource-Name>
   ```

2. Create an app with BYOS persistent storages

```azurecli
az spring-cloud app create -n <App-Name> -g <Resource-Group-Name> -s <Spring-Instance-Name> --persistent-storage "Path-To-JSON-File"
```

> [!Note]
> ```--persistent-storage``` accepts a path to a JSON file as the parameter. 
> Here is a sample JSON file:
> ```json
> {
>    "customPersistentDisks": [
>        {
>            "storageName": "<Storage-Resource-Name>",
>            "customPersistentDiskProperties": {
>                "type": "AzureFileVolume",
>                "shareName": "<Azure-File-Share-Name>",
>                "mountPath": "<Unique-Mount-Path e.g. /test/path>",
>                "mountOptions": [
>                    "uid=0",
>                    "gid=0",
>                ],
>                "readOnly": false 
>            }
>        },
>        {
>            "storageName": "<Storage-Resource-Name>",
>            "customPersistentDiskProperties": {
>                "type": "AzureFileVolume",
>                "shareName": "<Azure-File-Share-Name>",
>                "mountPath": "<Unique-Mount-Path e.g. /test/anotherPath>",
>                "readOnly": true
>            }
>        }
>    ]
>}
> ```

3. [Optional] Append an extra persistent storage to an existing app

```azurecli
az spring-cloud app append-persistent-storage --persistent-storage-type AzureFileVolume --share-name <Azure-File-Share-Name> --mount-path <Unique-Mount-Path e.g. /test/path> --storage-name <Storage-Resource-Name> -n <App-Name> -g <Resource-Group-Name> -s <Spring-Instance-Name>
```

4. [Optional] List all existing persistent storages of a specific storage resource 

```azurecli
az spring-cloud storage list-persistent-storage -g <Resource-Group-Name> -s <Spring-Instance-Name> -n <Storage-Resource-Name>
```
## Best Practices
- To avoid potential issues related to latency, it's a good choice to place the Azure Spring Cloud instance and the Azure Storage Account in the same Azure region.

- In the Azure Storage Account, avoid regenerating the account key that's being used. The storage account contains two different keys. Use a stepwise approach to ensure that the BYOS persistent storages remains available to the applications during key regeneration. 

   For example, assuming that you used key1 to bind storage account to Azure Spring Cloud:

   1. Regenerate key2.
   2. Update the account key of storage resource to use the regenerated key2. And restart the applications that mounts persistent storages from this storage resource. (You can use ```az spring-cloud storage list-persistent-storage``` to list all related applications.)
   3. Regenerate key1.

- If you delete an Azure Storage Account or Azure File Share, remove the corresponding storage resource or persistent storages in the applications to avoid possible error scenarios.

## FAQs

1. If I have built-in persistent storage enabled, and then I enabled BYOS as extra persistent storage. Will my data be migrated into my Storage Account?

   *No. But we are going to provide a doc to help you do the migration yourself in the near future.*

2. What are the reserved mount paths?

   *These mount paths are reserved by Azure Spring Cloud service:*
   - "/tmp"
   - "/persistent"
   - "/secrets"
   - "/app-insights/agents"
   - "/etc/azure-spring-cloud/certs"
   - "/app-insights/agents/settings"
   - "/app-lifecycle/settings"

3. What are the available mount options?

   *Now we only support the following mount options:*
   - "uid"
   - "gid"
   - "file_mode"
   - "dir_mode"
   
   *The mountOptions property is optional. The default values for above mount options are: ["uid=0", "gid=0", "file_mode=0777", "dir_mode=0777"]*

## Next steps

* Learn about [application and service quotas](./quotas.md).
* Learn how to [manually scale your application](./how-to-scale-manual.md).
